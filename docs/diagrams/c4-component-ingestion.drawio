<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36" version="29.3.0">
  <diagram name="C4 - Component - Ingestion Service" id="3WWI8DxWTFe9A08xpC0o">
    <mxGraphModel grid="1" page="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-1" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=18;fontStyle=1" value="C4: Component - Ingestion Service (Spring Boot)" vertex="1">
          <mxGeometry height="30" width="900" x="60" y="30" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-2" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6" value="Nginx Gateway&#xa;(mTLS verified)" vertex="1">
          <mxGeometry height="80" width="140" x="50" y="240" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-3" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656" value="RabbitMQ&#xa;telemetry.temperature" vertex="1">
          <mxGeometry height="90" width="280" x="1440" y="465" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-4" parent="1" style="shape=cylinder;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450" value="PostgreSQL&#xa;device + certificates" vertex="1">
          <mxGeometry height="120" width="280" x="1440" y="290" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-5" parent="1" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366" value="Ingestion Service" vertex="1">
          <mxGeometry height="560" width="1020" x="340" y="110" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-6" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366" value="TemperatureIngestController&#xa;REST endpoint: /api/ingest/v1/temperature" vertex="1">
          <mxGeometry height="90" width="230" x="385" y="170" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-7" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366" value="ClientIdentityExtractor&#xa;Reads fingerprint / DN from headers&#xa;(set by Nginx)" vertex="1">
          <mxGeometry height="90" width="240" x="780" y="170" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-8" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366" value="DeviceRegistryService&#xa;Fingerprint -&gt; Device&#xa;Checks ACTIVE/REVOKED" vertex="1">
          <mxGeometry height="80" width="180" x="1140" y="170" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-9" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366" value="PayloadValidator&#xa;Schema + ranges&#xa;Dedup key building (optional)" vertex="1">
          <mxGeometry height="90" width="240" x="380" y="340" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-10" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366" value="TelemetryEnricher&#xa;Adds receivedAt, ip, deviceId&#xa;Normalizes timestamps" vertex="1">
          <mxGeometry height="90" width="150" x="866" y="490" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-11" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366" value="TelemetryPublisher&#xa;Publishes event to RabbitMQ&#xa;(confirm / retry policy)" vertex="1">
          <mxGeometry height="120" width="150" x="1150" y="450" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-12" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;dashed=1" value="IdempotencyStore (optional)&#xa;Detects duplicates&#xa;(Redis / DB / in-memory)" vertex="1">
          <mxGeometry height="90" width="240" x="380" y="500" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-13" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366" value="Observability&#xa;Structured logs, metrics, tracing&#xa;Audit security events" vertex="1">
          <mxGeometry height="70" width="300" x="700" y="300" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-14" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366" value="DeviceRepository&#xa;DB access for devices/certs" vertex="1">
          <mxGeometry height="70" width="190" x="1130" y="320" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-15" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-2" style="endArrow=block;html=1;strokeWidth=2" target="zQuCzMYY4mkSFYt2EzfF-6" value="HTTPS (internal)&#xa;+ client fingerprint header">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-16" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-6" style="endArrow=block;html=1" target="zQuCzMYY4mkSFYt2EzfF-7" value="extract identity">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-17" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-7" style="endArrow=block;html=1" target="zQuCzMYY4mkSFYt2EzfF-8" value="resolve device">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-18" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-6" style="endArrow=block;html=1" target="zQuCzMYY4mkSFYt2EzfF-9" value="validate payload">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-19" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-9" style="endArrow=block;html=1" target="zQuCzMYY4mkSFYt2EzfF-10" value="enrich message">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-20" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-10" style="endArrow=block;html=1;strokeWidth=2" target="zQuCzMYY4mkSFYt2EzfF-11" value="publish event">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-21" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-9" style="endArrow=block;html=1;dashed=1" target="zQuCzMYY4mkSFYt2EzfF-12" value="(optional) dedup check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-22" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-6" style="endArrow=block;html=1" target="zQuCzMYY4mkSFYt2EzfF-13" value="metrics/logs">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-23" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-11" style="endArrow=block;html=1" target="zQuCzMYY4mkSFYt2EzfF-13" value="metrics/logs">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-24" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-8" style="endArrow=block;html=1;strokeWidth=2" target="zQuCzMYY4mkSFYt2EzfF-14" value="read device/cert data">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-25" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-14" style="endArrow=block;html=1;strokeWidth=2" target="zQuCzMYY4mkSFYt2EzfF-4" value="SQL">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="zQuCzMYY4mkSFYt2EzfF-26" edge="1" parent="1" source="zQuCzMYY4mkSFYt2EzfF-11" style="endArrow=block;html=1;strokeWidth=2" target="zQuCzMYY4mkSFYt2EzfF-3" value="AMQP publish">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
